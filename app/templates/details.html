{% extends "base.html" %}
{% block content %}

<div class="card">

{# ============================= #}
{# PLAGIARISM CONFIDENCE SUMMARY #}
{# ============================= #}

{% set confidence = "LOW" %}
{% set confidence_color = "#14532d" %}
{% set confidence_icon = "ðŸŸ¢" %}

{# Check repo similarity matrix #}
{% for row in similarity_matrix %}
    {% for v in row %}
        {% if v is not none and v|float >= 0.7 and file_similarity_table and file_similarity_table|length > 0 %}
            {% set confidence = "HIGH" %}
            {% set confidence_color = "#7f1d1d" %}
            {% set confidence_icon = "ðŸ”´" %}
        {% elif v is not none and v|float >= 0.4 and confidence != "HIGH" %}
            {% set confidence = "MEDIUM" %}
            {% set confidence_color = "#713f12" %}
            {% set confidence_icon = "ðŸŸ¡" %}
        {% endif %}
    {% endfor %}
{% endfor %}

{# Commit similarity fallback #}
{% if suspicious_commits and suspicious_commits|length > 0 and confidence == "LOW" %}
    {% set confidence = "MEDIUM" %}
    {% set confidence_color = "#713f12" %}
    {% set confidence_icon = "ðŸŸ¡" %}
{% endif %}

<div style="
    background:{{ confidence_color }};
    padding:18px 22px;
    border-radius:12px;
    margin-bottom:28px;
    border:1px solid #1f2937;
">
    <div style="font-size:20px; font-weight:700;">
        Plagiarism Confidence: {{ confidence }}
    </div>
    <div style="font-size:14px; opacity:.85; margin-top:6px;">
        This confidence is derived from repository similarity, fileâ€‘level matches,
        and commit message patterns.
    </div>
</div>

{# ============================= #}
{# FILE LEVEL SIMILARITY SECTION #}
{# ============================= #}

<h3>Fileâ€‘Level Similarity</h3>

{% if file_similarity_table and file_similarity_table|length > 0 %}

<div class="table-wrap">
<table style="width:100%; border-collapse:collapse;">
<tr>
    <th align="left">Repository A</th>
    <th align="left">File #</th>
    <th align="left">Repository B</th>
    <th align="left">File #</th>
    <th align="left">Similarity</th>
</tr>

{% for row in file_similarity_table %}
<tr>
    <td>{{ row.repo_a }}</td>
    <td>{{ row.file_a_index }}</td>
    <td>{{ row.repo_b }}</td>
    <td>{{ row.file_b_index }}</td>
    <td>{{ row.similarity }}</td>
</tr>
{% endfor %}
</table>
</div>

{% else %}
<p style="opacity:.75;">
No strong fileâ€‘level plagiarism detected.
</p>
{% endif %}

<hr style="margin:30px 0; opacity:.2;">

<h3>Comparisons</h3>

<button class="primary-btn"
onclick="location.href='{{ url_for('main.commit_diff_page') }}'">
Commit Message Similarity
</button>

<br><br>

<button class="primary-btn"
onclick="location.href='{{ url_for('main.repo_matrix_page') }}'">
Repository Similarity Matrix
</button>

<br><br>

<button class="primary-btn"
onclick="location.href='{{ url_for('main.compare_view') }}'">
View Sideâ€‘byâ€‘Side Code
</button>

<hr style="margin:30px 0; opacity:.2;">

<h3>Downloads</h3>

<button class="download-btn"
onclick="location.href='{{ url_for('main.download_report', type='csv') }}'">
Download CSV
</button>

<br><br>

<button class="download-btn"
onclick="location.href='{{ url_for('main.download_report', type='pdf') }}'">
Download PDF
</button>

</div>

{% endblock %}
