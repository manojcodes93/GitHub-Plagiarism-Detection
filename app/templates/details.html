

{% extends "base.html" %}
{% block content %}

<div class="card">

{# ============================= #}
{# PLAGIARISM CONFIDENCE SUMMARY #}
{# ============================= #}

{% set confidence = "LOW" %}
{% set confidence_color = "#14532d" %}

{% for row in similarity_matrix %}
    {% for v in row %}
        {% if v is not none and v|float >= 0.7 and file_similarity_table and file_similarity_table|length > 0 %}
            {% set confidence = "HIGH" %}
            {% set confidence_color = "#7f1d1d" %}
        {% elif v is not none and v|float >= 0.4 and confidence != "HIGH" %}
            {% set confidence = "MEDIUM" %}
            {% set confidence_color = "#713f12" %}
        {% endif %}
    {% endfor %}
{% endfor %}

{% if suspicious_commits and suspicious_commits|length > 0 and confidence == "LOW" %}
    {% set confidence = "MEDIUM" %}
    {% set confidence_color = "#713f12" %}
{% endif %}

<div style="
    background:{{ confidence_color }};
    padding:18px 22px;
    border-radius:12px;
    margin-bottom:28px;
">
    <div style="font-size:20px; font-weight:700;">
        Plagiarism Confidence: {{ confidence }}
    </div>
</div>

<hr>

<h3>File‑Level Similarity</h3>

{% if file_similarity_table and file_similarity_table|length > 0 %}
<table style="width:100%; border-collapse:collapse;">
<tr>
    <th>Repo A</th>
    <th>File #</th>
    <th>Repo B</th>
    <th>File #</th>
    <th>Similarity</th>
</tr>
{% for row in file_similarity_table %}
<tr>
    <td>{{ row.repo_a }}</td>
    <td>{{ row.file_a_index }}</td>
    <td>{{ row.repo_b }}</td>
    <td>{{ row.file_b_index }}</td>
    <td>{{ row.similarity }}</td>
</tr>
{% endfor %}
</table>
{% else %}
<p>No strong file‑level plagiarism detected.</p>
{% endif %}

<hr>

<h3>Comparisons</h3>

<button class="primary-btn"
onclick="location.href='{{ url_for('main.commit_diff_page') }}'">
Commit Message Similarity
</button>

<br><br>

<button class="primary-btn"
onclick="location.href='{{ url_for('main.repo_matrix_page') }}'">
Repository Similarity Matrix
</button>

<br><br>

<button class="primary-btn" onclick="showComingSoon(this)">
View Side‑by‑Side Code
</button>

<!-- COMING SOON MESSAGE (HIDDEN BY DEFAULT) -->
<div id="sideBySideComingSoon"
     style="
        display:none;
        margin-top:14px;
        padding:14px 16px;
        border-radius:10px;
        background:#020617;
        border:1px solid #334155;
        color:#e5e7eb;
        font-size:14px;
     ">
    <strong>Side‑by‑Side Code Comparison</strong><br>
    This feature is under development and will be available in a future update.
</div>

<hr>

<h3>Downloads</h3>

<button class="download-btn"
onclick="location.href='{{ url_for('main.download_report', type='csv') }}'">
Download CSV
</button>

<br><br>

<button class="download-btn"
onclick="location.href='{{ url_for('main.download_report', type='pdf') }}'">
Download PDF
</button>

</div>

<script>
function showComingSoon(btn) {
    const box = document.getElementById("sideBySideComingSoon");
    box.style.display = "block";

    // Optional UX polish
    btn.disabled = true;
    btn.innerText = "Side‑by‑Side (Coming Soon)";
}
</script>

{% endblock %}
