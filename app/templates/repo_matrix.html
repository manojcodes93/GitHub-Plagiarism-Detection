{% extends "base.html" %}

{% block content %}

<div class="card">

<h2>Repository Similarity Matrix</h2>

<p style="opacity:.8; margin-bottom:18px;">
Color guide:
ðŸŸ¢ Low &nbsp;&nbsp;
ðŸŸ¡ Medium &nbsp;&nbsp;
ðŸ”´ High similarity
</p>

<div class="table-wrap">

<table border="1" cellpadding="10" style="border-collapse:collapse; width:100%;">

<tr>
    <th>Repo</th>
    {% for n in names %}
    <th>{{ n }}</th>
    {% endfor %}
</tr>

{% for row in matrix %}
{% set row_repo = names[loop.index0] %}
<tr>

<th>{{ row_repo }}</th>

{% for v in row %}
{% set col_repo = names[loop.index0] %}

{% if v is none %}
<td style="background:#020617;">â€”</td>

{% else %}

{% set score = v|float %}

{% if score < 0.4 %}
    {% set bg = "#14532d" %}
    {% set label = "Low similarity" %}
{% elif score < 0.7 %}
    {% set bg = "#713f12" %}
    {% set label = "Medium similarity" %}
{% else %}
    {% set bg = "#7f1d1d" %}
    {% set label = "High similarity" %}
{% endif %}

{% set key1 = row_repo ~ "__" ~ col_repo %}
{% set key2 = col_repo ~ "__" ~ row_repo %}

<td style="
    background: {{ bg }};
    text-align:center;
    font-weight:600;
    border:1px solid #1f2937;
"
title="Similarity: {{ '%.3f'|format(score) }} â€” {{ label }}">

<div>{{ '%.3f'|format(score) }}</div>

{% if repo_similarity_explanations and (key1 in repo_similarity_explanations or key2 in repo_similarity_explanations) %}
    <div style="font-size:12px; opacity:.75; margin-top:4px;">
        {{ repo_similarity_explanations[key1] if key1 in repo_similarity_explanations else repo_similarity_explanations[key2] }}
    </div>
{% else %}
    <div style="font-size:12px; opacity:.55; margin-top:4px;">
        No strong fileâ€‘level evidence
    </div>
{% endif %}

</td>

{% endif %}
{% endfor %}

</tr>
{% endfor %}

</table>

</div>

<br>

<button class="primary-btn get-started-btn"
        onclick="location.href='{{ url_for('main.results_home') }}'">
Back to Results
</button>

</div>

{% endblock %}
