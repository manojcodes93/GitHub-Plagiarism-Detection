{% extends "base.html" %}
{% block content %}

<div class="card" style="max-width:1000px;margin:auto;">

<h2>Enter GitHub Repository URLs</h2>
<p style="opacity:.7;">Add repositories to compare similarity</p>

<form method="post" onsubmit="startAnalysis()">

<div id="repo-container"></div>

<br>

<button type="button" class="primary-btn" onclick="addRepo()">
+ Add Repository
</button>

<br><br>

<label>Similarity Threshold</label><br>
<input type="range" name="threshold"
       min="0.3" max="0.95" step="0.05" value="0.8"
       style="width:60%;"
       id="thresholdSlider" oninput="updateThresholdInfo()">

<div style="font-size:14px;">
    Value: <span id="thresholdValue">0.80</span> â€”
    <span id="thresholdLabel">Strict</span>
</div>

<br><br>

<input type="hidden" name="language" value=".py">

<button class="primary-btn" type="submit" id="runBtn">
Run Analysis
</button>

<button class="primary-btn"
        type="button"
        id="stopBtn"
        onclick="stopAnalysis()"
        style="display:none;background:#7f1d1d;">
Stop Analysis
</button>

</form>

<!-- ðŸ”„ Processing Section -->
<div id="processing" style="display:none;margin-top:40px;text-align:center;">
    <div class="spinner"></div>
    <p style="opacity:.7;margin-top:12px;">
        Analyzing repositoriesâ€¦ please wait
    </p>
</div>

</div>

<script>
function addRepo(value="") {
    const row = document.createElement("div");
    row.style.display="flex";
    row.style.gap="10px";
    row.style.marginBottom="12px";

    row.innerHTML = `
        <input name="repo_urls[]" value="${value}"
            placeholder="https://github.com/user/repo"
            style="flex:1;padding:12px;border-radius:10px;border:1px solid #334155;background:#020617;color:white;">
        <button type="button" onclick="this.parentNode.remove()"
            style="background:#7f1d1d;border:none;color:white;padding:0 14px;border-radius:10px;cursor:pointer;">
            âœ•
        </button>
    `;

    document.getElementById("repo-container").appendChild(row);
}

addRepo();
addRepo();

function updateThresholdInfo() {
    const v = parseFloat(document.getElementById("thresholdSlider").value);
    document.getElementById("thresholdValue").innerText = v.toFixed(2);

    let label = "Balanced";
    if (v >= 0.8) label = "Strict";
    else if (v < 0.55) label = "Loose";

    document.getElementById("thresholdLabel").innerText = label;
}
updateThresholdInfo();

function startAnalysis() {
    document.getElementById("processing").style.display = "block";
    document.getElementById("runBtn").style.display = "none";
    document.getElementById("stopBtn").style.display = "block";

    setTimeout(() => {
        document.getElementById("processing")
            .scrollIntoView({ behavior: "smooth" });
    }, 100);
}

function stopAnalysis() {
    document.getElementById("processing").style.display = "none";
    document.getElementById("runBtn").style.display = "block";
    document.getElementById("stopBtn").style.display = "none";
}
</script>

{% endblock %}
